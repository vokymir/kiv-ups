\documentclass[czech, kiv, he, sem, pdf, viewonly]{fasthesis}

\usepackage{pdfpages}

\usepackage{float}

\title{Karetní hra prší pro dva hráče realizovaná nad TCP}

\author{Jakub}{Vokoun}{}{}

\nobastardtitle \nocopyrightnotice

\begin{document} \frontpages[notm]

\tableofcontents

\chapter{Zadání}

Pro karetní hru prší, v konkrétních pravidlech: nedá se přebíjet sedmička ani
eso, měnič mění pouze na svojí barvu, naprogramujte server v jazyce C nebo C++
spustitelný běžnými nástroji na OS GNU/Linux. Vytvořte klienta v jiném jazyce
(zvolen Python) jako přenositelnou aplikaci, která podporuje GNU/Linux i MS
Windows.

Síťová hra pro více hráčů s architekturou 1:N (server - klienti) fungující nad
protokolem TCP, za použití standardních BSD socketů. Cílem semestrální práce je
fungující aplikace s dobrým návrhem protokolu a jeho implementací.

\chapter{Protokol}

Komunikace mezi serverem a klientem není řízená celou dobu z jedné strany.
Samotná hra je iniciovaná a řízená serverem, pohyb klienta po serveru je řízen
klientem.

Klient se může v jednu chvíli nacházet pouze v jednom stavu. Stavy jsou
následující:

\begin{itemize}

    \item unnamed: Nepojmenovaný klient, pouze připojen na server.

    \item lobby: Pojmenovaný klient, který se může připojit do místností.

    \item room: Pojmenovaný klient v místnosti, čeká na její zaplnění.

    \item game: Pojmenovaný klient v místnost hraje/dohrál hru.

\end{itemize}


\begin{figure}[H]

    \centering

    \includegraphics[width=0.5\textwidth]{img/protocol_flow.pdf}

    \caption{Průchod klienta serverem.}

    \label{fig:protocol_flow}

\end{figure}

Každá existující místnost se musí nacházet v jednom ze stavů: OPEN, PLAYING,
FINISHED. Přičemž stav OPEN znamená, že je volné místo pro dalšího hráče, stav
PLAYING že probíhá hra, a stav FINISHED, že hra byla ukončena, ale ještě
nejméně jeden klient neopustil místnost.

Zprávy v protokolu mají proměnnou délku, v závislosti jak na typu zprávy, tak i
na přenášených datech. Protokol používá lidsky čitelná anglická slova psaná
velkými písmeny. Jednotlivé části zprávy jsou odděleny mezerou, zprávy jsou od
sebe odděleny znakem |. Každá zpráva začíná tzv. magickem PRSI. Protokol vypadá
následovně:

Formát zprávy:

\begin{center}

    \textbf{PRSI ... |}

\end{center}


\input{partials/protocol.tex}

Poznámky k protokolu:

\begin{itemize}

    \item Výběr jména nemůže neuspět, jelikož pokud si klient zvolí jméno
        stejné, jako již existující hráč, server předpokládá změnu koncového
        zařízení klienta a hráči nastaví nový FD, tedy přiřadí hráče novému
        socketu.

    \item Zprávy ze serveru o stavu klienta mohou být velice dlouhé, zvlášť
        pokud je ve hře. Vyjde to ale levněji, než posílat tři zprávy zvlášť,
        kvůli magicu a oddělovači.

    \item Na jméno hráče nejsou kladeny žádné požadavky, kromě toho, že nesmí
        obsahovat oddělovač (|) a bílé znaky. To také znamená, že dlouhé jméno
        hráče může významně zpomalit přenos. (teoreticky) Útočníci s dlouhým
        jménem by mohli naschvál způsobovat krátkou nedostupnost a opět se
        připojovat a tím saturovat síť oběti, protože obě tyto zprávy obsahují
        jméno klienta.

\end{itemize}

\chapter{Uživatelská příručka}

Server by mělo být možné spustit na libovolné GNU/Linux zařízení, kde je možné
přeložit a spustit C++ 23, a kam může být připojena knihovna fmt. Pokud by byl
problém s knihovnou, tím že je použitá pouze pro logger můžete třídu Logger
upravit a o mnoho nepřijdete.

Kompilace/spuštění serveru: \input{partials/server_setup.tex}

Server lze nakonfigurovat v textovém souboru, který bude programu předaný při
spuštění. Formát souboru je: jedna konfigurační proměnná na řádek, mezerou
oddělená od hodnoty. Pokud se proměnná vyskytuje v souboru vícekrát, směrodatný
je její poslední výskyt.

\input{partials/config.tex}

Klientská aplikace je napsána v jazyku Python 3 a měla by být spustitelná na
jakémkoliv zařízení s interpretem pythonu v dané verzi a knihovnami pillow a
typing\_extensions. Doporučený postup je použít virtuální prostředí. Ukázkový
skript pro GNU/Linux Debian:

\input{partials/client_setup.tex}

Na MS Windows použijte ekvivalentní postup.




\backmatter \backpage \end{document}
